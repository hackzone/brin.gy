<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">

<head>
    <meta http-equiv="refresh" content="300">
    
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/physics/ParticleModel.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/physics/Magnet.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/physics/Spring.js" %}'></script> 

    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/physics/Particle.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/physics/RungeKuttaIntegrator.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/layout/graph/ForceDirectedLayout.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/layout/view/SVGGraphView.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/util/Timer.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/util/EventHandler.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jsviz/0.3.3/io/DataGraph.js" %}'></script>

    <script language="JavaScript" src='{% url resources "scripts/graph.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/jquery-1.3.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/sugar.js" %}'></script>
    <script language="JavaScript" src='{% url resources "scripts/requester.js" %}'></script>
    
    <script type="text/javascript">

        var nodes = {};
        var requester = new Requester("{% url ego_website.ajax.poll_result %}");
        
        {% for url, details in agents.iteritems %}
            nodes["{{url}}"] = [];
            {% for dest_url in details.dests %}
                nodes["{{url}}"].push("{{dest_url}}");
                //console.log(nodes)
            {% endfor %}
        {% endfor %}

        function on_node_hover(url) {
            $("#profile").html('<img src={% url resources "images/loader.gif" %}></img>');
            var on_success = function(result) {
                var user = result["result"]["user"];
                var profile = result["result"]["profile"];

                var first_name = user["first_name"];
                var last_name = user["last_name"];
                var img_url = profile["image"];
                $("#profile").empty();
                $("#profile").append("<span class='profile-first'>" + first_name + " </span><span class='profile-last'>" + last_name + "</span>");
                $("#profile").append("<img class='profile-image' src=" + img_url + "></img>");
                $("#profile").append("<span class='profile-url'>" + url + "</span>");
            }
            
            var on_failure = function(result) {
                $("#profile").empty();
                $("#profile").append("Could not get profile from " + url);
            }
            
            requester.make_request("{% url ego_website.ajax.get_friend_profile %}", {"friend_url":url}, on_success, on_failure);
        }
        
        window.onload = function() {
            var handlers = [on_node_hover];
            RenderGraph("graph", nodes, handlers);
        }
    </script>
    
    <link href='{% url resources "styles/graph.css" %}' rel="stylesheet" type="text/css" />
    <style type="text/css">

        html, body {
            height: 95%;
            background-color: #161616;
        }
        
        #title {
            font-size: 96px;
            display: block;
        }
        
        #learn {
            font-size: 20px;
            display: block;
        }
        
        td {
            height: 100%;
            vertical-align: top;
        }
        
        table {
            height: 100%;
        }
        
        #left {
            padding-left: 50px;
            width: 25%;
            color: white;
        }
        
        #right {
            width: 75%;
        }
        
        #graph {
            height: 100%;
            width: 100%;
        }
        
        #profile {
            width: 100%;
            height: 100%;
            font-size: 24px;
            margin-top: 20px;
        }
        
        
        .profile-first {
        }
        
        .profile-last {
            font-weight: bold;
        }
        
        .profile-image {
            display: block;
            max-width: 200px;
            max-height: 200px;
        }
        
        .profile-url {
            font-size: 16px;
        }
    </style>
</head>

<body>
    <table>
        <tr>
            <td id="left">
                <span id="title">ego</span>
                <span id="learn">learn more at http://ego.media.mit.edu</span>
                <div id="profile"></div>
            </td>
            <td id="right">
            <div id="graph"></div>
            </td>
        </tr>
    </table>
</body>
</html>